<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zcc.highmyopia.mapper.IReportFilesMapper">

    <resultMap id="ReportFileResultMap" type="com.zcc.highmyopia.po.ReportFiles">
        <result column="id" property="id" jdbcType="BIGINT"/>
        <result column="report_id" property="reportId" jdbcType="BIGINT"/>
        <result column="file_type" property="type" jdbcType="VARCHAR"/>
        <result column="file_url" property="url" jdbcType="LONGVARCHAR"/>  <!-- TEXT 类型映射为 LONGVARCHAR -->
        <result column="is_download" property="isDownLoad" jdbcType="SMALLINT"/>
        <result column="file_path" property="filePath" jdbcType="VARCHAR"/>
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="update_time" property="updateTime" jdbcType="TIMESTAMP"/>
    </resultMap>


    <insert id="insertBatch" parameterType="com.zcc.highmyopia.po.ReportFiles">
        insert into report_files (id, report_id, type, url, is_down_load, file_path, create_time, update_time)
        values
        <foreach item="file" index="index" collection="list" open="(" separator=")," close=")">
            #{file.id}, #{file.reportId}, #{file.fileType}, #{file.fileUrl}, #{file.isDownLoad}, #{file.filePath}, now(), now()
        </foreach>
    </insert>

    <update id="updateReportFiles" parameterType="com.zcc.highmyopia.po.ReportFiles">
        update report_files
        set is_down_load = #{isDownLoad}, file_path = #{filePath}, update_time = now()
        where id = #{id};
    </update>

    <select id="getNotDownLoad" resultType="com.zcc.highmyopia.po.ReportFiles">
        select * from report_files
        where is_down_load = 0
    </select>

    <select id="queryBatch" resultType="com.zcc.highmyopia.po.ReportFiles">
        select *
        from report_files
        where report_id = #{reportId}
    </select>
    <select id="getReportFileById" resultType="com.zcc.highmyopia.po.ReportFiles"
            parameterType="java.lang.Long">
        select * from report_files
        where report_id = #{id} and type = 'application/pdf' and is_down_load = 1
    </select>

</mapper>
